<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>H·ªá th·ªëng Gi√°m s√°t ƒê·ªông c∆° C√¥ng nghi·ªáp - L·ªãch s·ª≠ S·ª± c·ªë</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Hi·ªáu ·ª©ng chuy·ªÉn ƒë·ªông m∆∞·ª£t m√† cho sidebar */
    .sidebar-item {
      transition: all 0.3s ease-in-out;
    }
    .sidebar-item:hover {
      transform: translateX(5px);
    }
    /* Hi·ªáu ·ª©ng cho main content */
    .main-content {
      animation: fadeIn 0.5s ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    /* ƒê√°nh d·∫•u m·ª•c active */
    .sidebar-item.active {
      background-color: rgba(255, 255, 255, 0.1);
      font-weight: bold;
      border-left: 4px solid #ffffff;
    }
    /* T√πy ch·ªânh b·∫£ng s·ª± c·ªë */
    .incident-table {
      width: 100%;
      border-collapse: collapse;
    }
    .incident-table th, .incident-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #e5e7eb;
    }
    .incident-table th {
      background-color: #f3f4f6;
      color: #374151;
      font-weight: bold;
    }
    .incident-table tr:hover {
      background-color: #f9fafb;
    }
  </style>
</head>
<body class="bg-gray-50 font-sans antialiased">

  <div class="flex h-screen">
    <!-- Sidebar -->
    <aside class="w-64 bg-gradient-to-b from-blue-700 to-blue-900 text-white shadow-xl">
      <div class="p-4 text-2xl font-extrabold border-b border-blue-500/30 flex items-center">
        <span class="mr-3">‚öôÔ∏è</span>Gi√°m s√°t ƒê·ªông c∆°
      </div>
      <nav class="mt-4">
        <ul>
          <li class="px-4 py-3 text-lg hover:bg-blue-600/80 cursor-pointer rounded-r-lg flex items-center sidebar-item">
            <a href="home.html" class="flex items-center w-full"><span class="mr-3">üè†</span> Trang Ch·ªß</a>
          </li>
          <li class="px-4 py-3 text-lg hover:bg-blue-600/80 cursor-pointer rounded-r-lg flex items-center sidebar-item">
            <a href="datarealtime.html" class="flex items-center w-full"><span class="mr-3">üìà</span> D·ªØ Li·ªáu Th·ªùi Gian Th·ª±c</a>
          </li>
          <li class="px-4 py-3 text-lg hover:bg-blue-600/80 cursor-pointer rounded-r-lg flex items-center sidebar-item">
            <a href="alert.html" class="flex items-center w-full"><span class="mr-3">üîç</span> Chu·∫©n ƒëo√°n L·ªói</a>
          </li>
          <li class="px-4 py-3 text-lg hover:bg-blue-600/80 cursor-pointer rounded-r-lg flex items-center sidebar-item active">
            <a href="history.html" class="flex items-center w-full"><span class="mr-3">üìã</span> L·ªãch S·ª≠ S·ª± c·ªë</a>
          </li>
          <li class="px-4 py-3 text-lg hover:bg-blue-600/80 cursor-pointer rounded-r-lg flex items-center sidebar-item">
            <a href="settings.html" class="flex items-center w-full"><span class="mr-3">‚öôÔ∏è</span> C√†i ƒê·∫∑t</a>
          </li>
          <li class="px-4 py-3 text-lg hover:bg-blue-600/80 cursor-pointer rounded-r-lg flex items-center sidebar-item">
            <a href="#" onclick="logout()" class="flex items-center w-full"><span class="mr-3">üö™</span> ƒêƒÉng Xu·∫•t</a>
          </li>
        </ul>
      </nav>
    </aside>

    <!-- N·ªôi dung ch√≠nh -->
    <main class="flex-1 p-4 main-content overflow-y-auto h-full">
      <!-- Header -->
      <div class="flex flex-col items-center mb-4">
        <h1 class="text-2xl font-bold text-gray-800 text-center">L·ªãch s·ª≠ S·ª± c·ªë ƒê·ªông c∆° ƒêi·ªán</h1>
        <p class="text-sm text-gray-500 mt-1">C·∫≠p nh·∫≠t: <span id="current-time" class="font-semibold"></span></p>
      </div>

      <!-- B·∫£ng hi·ªÉn th·ªã l·ªãch s·ª≠ s·ª± c·ªë -->
      <div class="bg-white rounded-xl shadow-lg p-6">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">Danh s√°ch S·ª± c·ªë</h3>
        <table class="incident-table">
          <thead>
            <tr>
              <th>Th·ªùi gian</th>
              <th>Thi·∫øt b·ªã ID</th>
              <th>Lo·∫°i s·ª± c·ªë</th>
              <th>Th√¥ng b√°o</th>
              <th>Tr·∫°ng th√°i</th>
            </tr>
          </thead>
          <tbody id="incident-table-body"></tbody>
        </table>
      </div>
    </main>
  </div>

  <script>
    // H√†m ƒëƒÉng xu·∫•t
    function logout() {
      localStorage.removeItem("username");
      alert("ƒêƒÉng xu·∫•t th√†nh c√¥ng!");
      window.location.href = "login.html";
    }

    // C·∫≠p nh·∫≠t th·ªùi gian hi·ªán t·∫°i
    function updateTime() {
      const now = new Date();
      document.getElementById('current-time').textContent = now.toLocaleString('vi-VN');
    }
    updateTime();
    setInterval(updateTime, 1000);

    // H√†m l·∫•y v√† hi·ªÉn th·ªã danh s√°ch s·ª± c·ªë t·ª´ API
    async function fetchAndDisplayIncidents() {
      try {
        const response = await fetch('http://127.0.0.1:8000/L·∫•y danh s√°ch c·∫£nh b√°o', {
          method: 'GET',
          headers: { 'Content-Type': 'application/json' }
        });
        if (!response.ok) {
          throw new Error('Kh√¥ng th·ªÉ l·∫•y danh s√°ch s·ª± c·ªë t·ª´ API');
        }
        const incidents = await response.json();

        // Hi·ªÉn th·ªã s·ª± c·ªë trong b·∫£ng
        const tableBody = document.getElementById('incident-table-body');
        tableBody.innerHTML = ''; // X√≥a n·ªôi dung c≈©
        incidents.forEach(incident => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${new Date(incident.timestamp).toLocaleString('vi-VN')}</td>
            <td>${incident.device_id}</td>
            <td>${incident.alert}</td>
            <td>${incident.message}</td>
            <td>${incident.status}</td>
          `;
          tableBody.appendChild(row);
        });

      } catch (error) {
        console.error('L·ªói khi l·∫•y d·ªØ li·ªáu:', error);
        alert('Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu t·ª´ server. Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi ho·∫∑c server.');
      }
    }

    // G·ªçi h√†m l·∫•y v√† hi·ªÉn th·ªã s·ª± c·ªë ngay khi t·∫£i trang
    fetchAndDisplayIncidents();

    // C·∫≠p nh·∫≠t d·ªØ li·ªáu m·ªói 10 gi√¢y
    setInterval(fetchAndDisplayIncidents, 10000);
  </script>
</body>
</html>